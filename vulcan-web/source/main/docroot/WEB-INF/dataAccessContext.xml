<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" 
	"http://www.springframework.org/dtd/spring-beans.dtd">
<!-- 
	$Id$
	$HeadURL$
-->
<beans>

	<!-- hsqldb configuration -->
	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
		<property name="driverClassName" value="org.hsqldb.jdbcDriver"/>
		<property name="url" value="jdbc:hsqldb:file:${vulcan.home}/hsqldb/builds;shutdown=true"/>
		<property name="username" value="sa"/>
		<property name="defaultAutoCommit" value="false"/>
	</bean>
	
	<bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource"/>
	</bean>
	
	<!-- jndi configuration -->
	<!--
	<bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName" value="jdbc/vulcan"/>
		<property name="resourceRef" value="true"/>
	</bean>
	-->
	
	<!-- buildOutcomeStore definition and transaction configuration -->
	<bean id="buildOutcomeStore" class="net.sourceforge.vulcan.spring.jdbc.JdbcBuildOutcomeStore"
			init-method="init">
		<property name="createScript" value="classpath:net/sourceforge/vulcan/resources/create_tables.sql"/>
		<property name="dataSource" ref="dataSource"/>
		<property name="configurationStore" ref="configurationStore"/>	
	</bean>

	<bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/>

	<bean class="org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor">
		<property name="transactionInterceptor" ref="txInterceptor"/>
	</bean>

	<bean id="txInterceptor" class="org.springframework.transaction.interceptor.TransactionInterceptor">
		<property name="transactionManager" ref="txManager"/>
		<property name="transactionAttributeSource">
			<bean class="org.springframework.transaction.annotation.AnnotationTransactionAttributeSource"/>
		</property>
	</bean>	
</beans>